!function(t){var e=t.cm={};e.options={syntax:{bindSyntaxLeft:"{{",bindSyntaxRight:"}}",bindSyntaxRegexp:/\{{2}\s*([a-zA-Z0-9_]*)\s*\}{2}/g}},e.bootstrap=function(t,e){var o=new p(t);e._startBind(o)},e.createModel=function(t){return new o(t)},e.Binder=function(){};var o=e.Model=function(t){this.props={},this.compiler=null,this.isStart=!1,"function"!=typeof this._startBind&&(o.prototype._destroy=function(){this.props=null,this.isStart=!1},o.prototype._startBind=function(t){this.compiler=t;for(prop in this.compiler.modelNodes){var e=this.compiler.modelNodes[prop],o=this;e.expr in this.props||(this.props[e.expr]=void 0,this.addProp(e.expr,null)),e instanceof s?(e.ele.value=null===this.props[e.expr]||"undefined"==typeof this.props[e.expr]?"":this.props[e.expr],e.ele.onkeyup=function(){console.log("keyup"),o.props[this.cmNode.expr]=this.value}):((null===this.props[e.expr]||"undefined"==typeof this.props[e.expr])&&(e.textContent=""),e.textContent=this.props[e.expr])}this.isStart=!0},o.prototype._digest=function(){if(this.isStart)for(prop in this.props)if(this.props[prop]!==this.props["_last"+prop]){this.props["_last"+prop]=this.props[prop];for(var t in this.compiler.modelNodes){var e=this.compiler.modelNodes[t];if(e.expr===prop){if(e instanceof s){e.ele.value=this.props[prop];continue}e.textContent=this.props[prop]}}}},o.prototype.addProp=function(t,e){var o=this;Object.defineProperty(this.props,t,{get:function(){return this["_"+t]},set:function(e){this["_"+t]=e,o._digest()},enumerable:!0,configurable:!0}),this.props[t]=e,this.props["_last"+t]=e});for(var e in t)this.addProp(e,t[e])},i=e.Node=function(t,e,o){this.ele=t,this.ele.cmNode=this,this.modelType=e,this.expr=o},s=function(t,e){i.call(this,t,"TEXT_NODE",e)},p=e.Compiler=function(t){this.ele=t,this.modelNodes=[],"function"!=typeof this.compileHTML&&(p.prototype._destroy=function(){this.ele=null,this.modelNodes=null},p.prototype._compile=function(t){this._checkDisplayModel(t),this._checkModel(t);for(var e=0;e<t.childNodes.length;e++){var o=t.childNodes[e];this._compile(o)}},p.prototype.compileHTML=function(){return this._compile(this.ele),this.modelNodes},p.prototype._isModelNode=function(){},p.prototype._checkModel=function(t){return 3!==t.nodeType?"INPUT"===t.nodeName&&"text"===t.type&&t.attributes["cm-model"]?void this.modelNodes.push(new s(t,t.attributes["cm-model"].value)):"TEXTAREA"===t.nodeName&&t.attributes["cm-model"]?void this.modelNodes.push(new s(t,t.attributes["cm-model"].value)):void 0:void 0},p.prototype._checkDisplayModel=function(t){if(3===t.nodeType)for(var o=null,i=null,s=null,p=null,n=e.options.syntax.bindSyntaxRegexp;o=n.exec(t.textContent);){var r=n.lastIndex-o[0].length;p=document.createTextNode(""),p.expr=o[1],i=document.createTextNode(t.textContent.substr(0,r)),s=document.createTextNode(t.textContent.substr(n.lastIndex));var l=t.parentNode;return l.insertBefore(i,t),l.insertBefore(p,t),l.insertBefore(s,t),this.modelNodes.push(p),void l.removeChild(t)}}),this.compileHTML()}}(window);