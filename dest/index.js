!function(t){var e=t.cm={};e.options={syntax:{bindSyntaxLeft:"{{",bindSyntaxRight:"}}",bindSyntaxRegexp:/\{{2}\s*([a-zA-Z0-9_]*)\s*\}{2}/g}},e.bootstrap=function(t,e){var o=new n(t);console.log(o.modelNodes),window.list=o.modelNodes,e._startBind(o)},e.createModel=function(t){return new o(t)},e.Binder=function(){};var o=e.Model=function(t){if(this.props={},this.compiler=null,this.isStart=!1,"function"!=typeof this._startBind){o.prototype._destroy=function(){this.props=null,this.isStart=!1},o.prototype._startBind=function(t){this.compiler=t;for(prop in this.compiler.modelNodes){var e=this.compiler.modelNodes[prop],o=this;e.expr in this.props||(this.props[e.expr]=void 0,this.addProp(e.expr,null)),e instanceof s?(e.ele.value=null===this.props[e.expr]||"undefined"==typeof this.props[e.expr]?"":this.props[e.expr],e.ele.onkeyup=function(){o.props[this.cmNode.expr]=this.value}):((null===this.props[e.expr]||"undefined"==typeof this.props[e.expr])&&(e.textContent=""),e.textContent=this.props[e.expr])}this.isStart=!0},o.prototype._digest=function(){if(console.log("digest"),this.isStart)for(prop in this.props)if(this.props[prop]!==this.props["_last"+prop]){this.props["_last"+prop]=this.props[prop];for(var t in this.compiler.modelNodes){var e=this.compiler.modelNodes[t];if(e.expr===prop){if(e instanceof s){e.ele.value=this.props[prop];continue}e.textContent=this.props[prop]}}}};var e=this._digest.bind(this);o.prototype.addProp=function(t,o){Object.defineProperty(this.props,t,{get:function(){return this["_"+t]},set:function(o){this["_"+t]=o,e()},enumerable:!0,configurable:!0}),this.props[t]=o,this.props["_last"+t]=o}}for(var i in t)this.addProp(i,t[i])},i=e.Node=function(t,e,o){this.ele=t,this.ele.cmNode=this,this.modelType=e,this.expr=o},s=function(t,e){i.call(this,t,"TEXT_NODE",e)},n=e.Compiler=function(t){this.ele=t,this.modelNodes=[],"function"!=typeof this.compileHTML&&(n.prototype._destroy=function(){this.ele=null,this.modelNodes=null},n.prototype._compile=function(t){for(var e=0;e<t.childNodes.length;e++){var o=t.childNodes[e];this._checkDisplayModel(o),this._checkModel(o),o.childNodes&&o.childNodes.length>0&&this._compile(o)}},n.prototype.compileHTML=function(){return this._compile(this.ele),this.modelNodes},n.prototype._isModelNode=function(){},n.prototype._checkModel=function(t){return 3!==t.nodeType?"INPUT"===t.nodeName&&"text"===t.type&&t.attributes["cm-model"]?void this.modelNodes.push(new s(t,t.attributes["cm-model"].value)):"TEXTAREA"===t.nodeName&&t.attributes["cm-model"]?void this.modelNodes.push(new s(t,t.attributes["cm-model"].value)):void 0:void 0},n.prototype._checkDisplayModel=function(t){if(3===t.nodeType)for(var o=null,i=null,s=null,n=null,p=e.options.syntax.bindSyntaxRegexp;o=p.exec(t.textContent);){var r=p.lastIndex-o[0].length;n=document.createTextNode(""),n.expr=o[1],i=document.createTextNode(t.textContent.substr(0,r)),s=document.createTextNode(t.textContent.substr(p.lastIndex));var l=t.parentNode;return l.insertBefore(i,t),l.insertBefore(n,t),l.insertBefore(s,t),this.modelNodes.push(n),void l.removeChild(t)}}),this.compileHTML()}}(window);